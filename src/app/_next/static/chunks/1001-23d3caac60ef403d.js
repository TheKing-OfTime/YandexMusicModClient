"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1001],{41172:function(t,e,r){r.d(e,{r:function(){return v}});var i=r(26698);class a{get delete(){var t;return null===(t=this.cursor.delete)||void 0===t?void 0:t.bind(this.cursor)}get update(){var t;return null===(t=this.cursor.update)||void 0===t?void 0:t.bind(this.cursor)}[Symbol.asyncIterator](){return this.cursor[Symbol.asyncIterator]()}constructor(t){Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"primaryKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"advance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"continue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"continuePrimaryKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.direction=t.direction,this.request=t.request,this.primaryKey=t.primaryKey,this.key=t.key,this.advance=t.advance.bind(t),this.continue=t.continue.bind(t),this.continuePrimaryKey=t.continuePrimaryKey.bind(t)}}class n extends a{[Symbol.asyncIterator](){return this.cursor[Symbol.asyncIterator]()}constructor(t){super(t),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=t.value}}var o=function(t,e,r,i){return new(r||(r=Promise))(function(a,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?a(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(o,s)}c((i=i.apply(t,e||[])).next())})};class s{get(t){return o(this,void 0,void 0,function*(){return this.index.get(t)})}getAll(t,e){return o(this,void 0,void 0,function*(){return this.index.getAll(t,e)})}getAllKeys(t,e){return o(this,void 0,void 0,function*(){return this.index.getAllKeys(t,e)})}getKey(t){return o(this,void 0,void 0,function*(){return this.index.getKey(t)})}count(t){return o(this,void 0,void 0,function*(){return this.index.count(t)})}openCursor(t,e){return o(this,void 0,void 0,function*(){let r=yield this.index.openCursor(t,e);return r&&new n(r)})}openKeyCursor(t,e){return o(this,void 0,void 0,function*(){let r=yield this.index.openKeyCursor(t,e);return r&&new a(r)})}[Symbol.asyncIterator](){return this.index[Symbol.asyncIterator]()}iterate(t,e){return this.index.iterate(t,e)}constructor(t){Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"keyPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiEntry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"unique",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyPath=t.keyPath,this.multiEntry=t.multiEntry,this.name=t.name,this.unique=t.unique}}var c=function(t,e,r,i){return new(r||(r=Promise))(function(a,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?a(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(o,s)}c((i=i.apply(t,e||[])).next())})};class l{get indexNames(){return this.objectStore.indexNames}get put(){var t;return null===(t=this.objectStore.put)||void 0===t?void 0:t.bind(this.objectStore)}get add(){var t;return null===(t=this.objectStore.add)||void 0===t?void 0:t.bind(this.objectStore)}get clear(){var t;return null===(t=this.objectStore.clear)||void 0===t?void 0:t.bind(this.objectStore)}get delete(){var t;return null===(t=this.objectStore.delete)||void 0===t?void 0:t.bind(this.objectStore)}createIndex(t,e,r){return this.objectStore.createIndex?new s(this.objectStore.createIndex(t,e,r)):null}deleteIndex(t){return this.objectStore.deleteIndex(t)}count(t){return c(this,void 0,void 0,function*(){return this.objectStore.count(t)})}get(t){return c(this,void 0,void 0,function*(){return this.objectStore.get(t)})}getAll(t,e){return c(this,void 0,void 0,function*(){return this.objectStore.getAll(t,e)})}getAllKeys(t,e){return c(this,void 0,void 0,function*(){return this.objectStore.getAllKeys(t,e)})}getKey(t){return c(this,void 0,void 0,function*(){return this.objectStore.getKey(t)})}index(t){return new s(this.objectStore.index(t))}openKeyCursor(t,e){return c(this,void 0,void 0,function*(){let r=yield this.objectStore.openKeyCursor(t,e);return r&&new a(r)})}openCursor(t,e){return c(this,void 0,void 0,function*(){let r=yield this.objectStore.openCursor(t,e);return r&&new n(r)})}iterate(t,e){return this.objectStore.iterate(t,e)}[Symbol.asyncIterator](){return this.objectStore[Symbol.asyncIterator]()}constructor(t){Object.defineProperty(this,"objectStore",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"autoIncrement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.autoIncrement=t.autoIncrement,this.keyPath=t.keyPath,this.name=t.name}}class h{get error(){return this.transaction.error}get done(){return this.transaction.done}abort(){return this.transaction.abort()}commit(){return this.transaction.commit()}objectStore(t){return new l(this.transaction.objectStore(t))}addEventListener(t,e,r){return this.transaction.addEventListener(t,e,r)}removeEventListener(t,e,r){return this.transaction.removeEventListener(t,e,r)}set onabort(t){this.transaction.onabort=t}set onerror(t){this.transaction.onerror=t}set oncomplete(t){this.transaction.oncomplete=t}dispatchEvent(t){return this.transaction.dispatchEvent(t)}constructor(t){Object.defineProperty(this,"transaction",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"durability",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"objectStoreNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.durability=t.durability,this.mode=t.mode,this.objectStoreNames=t.objectStoreNames}}var u=function(t,e,r,i){return new(r||(r=Promise))(function(a,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?a(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(o,s)}c((i=i.apply(t,e||[])).next())})};class d{get objectStoreNames(){return this.database.objectStoreNames}transaction(t,e,r){return new h(this.database.transaction(t,e,r))}createObjectStore(t,e){return new l(this.database.createObjectStore(t,e))}deleteObjectStore(t){return this.database.deleteObjectStore(t)}get(t,e){return u(this,void 0,void 0,function*(){return this.database.get(t,e)})}getAll(t,e,r){return u(this,void 0,void 0,function*(){return this.database.getAll(t,e,r)})}add(t,e,r){return u(this,void 0,void 0,function*(){return this.database.add(t,e,r)})}put(t,e,r){return u(this,void 0,void 0,function*(){return this.database.put(t,e,r)})}delete(t,e){return u(this,void 0,void 0,function*(){return this.database.delete(t,e)})}clear(t){return u(this,void 0,void 0,function*(){return this.database.clear(t)})}count(t,e){return u(this,void 0,void 0,function*(){return this.database.count(t,e)})}getKey(t,e){return u(this,void 0,void 0,function*(){return this.database.getKey(t,e)})}getAllKeys(t,e,r){return u(this,void 0,void 0,function*(){return this.database.getAllKeys(t,e,r)})}countFromIndex(t,e,r){return u(this,void 0,void 0,function*(){return this.database.countFromIndex(t,e,r)})}getFromIndex(t,e,r){return u(this,void 0,void 0,function*(){return this.database.getFromIndex(t,e,r)})}getAllFromIndex(t,e,r,i){return u(this,void 0,void 0,function*(){return this.database.getAllFromIndex(t,e,r,i)})}getAllKeysFromIndex(t,e,r,i){return u(this,void 0,void 0,function*(){return this.database.getAllKeysFromIndex(t,e,r,i)})}getKeyFromIndex(t,e,r){return u(this,void 0,void 0,function*(){return this.database.getKeyFromIndex(t,e,r)})}addEventListener(t,e,r){this.database.addEventListener(t,e,r)}removeEventListener(t,e,r){this.database.removeEventListener(t,e,r)}set onabort(t){this.database.onabort=t}set onclose(t){this.database.onclose=t}set onerror(t){this.database.onerror=t}set onversionchange(t){this.database.onversionchange=t}close(){return this.database.close()}dispatchEvent(t){return this.database.dispatchEvent(t)}constructor(t){Object.defineProperty(this,"database",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.version=t.version,this.name=t.name}}var g=function(t,e,r,i){return new(r||(r=Promise))(function(a,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?a(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(o,s)}c((i=i.apply(t,e||[])).next())})};class v{openDB(t){let{onBlocked:e,onBlocking:r,onTerminated:a,onUpgrade:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return g(this,void 0,void 0,function*(){let o=yield(0,i.X3)(this.name,t,{blocked:e,blocking:r,terminated:a,upgrade:(t,e,r,i,a)=>{let o=new d(t);null==n||n(o,e,r,new h(i),a)}});return new d(o)})}deleteDB(t){let{onBlocked:e}=t;return g(this,void 0,void 0,function*(){yield(0,i.Lj)(this.name,{blocked:e})})}constructor(t){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t})}}},90632:function(t,e,r){r.d(e,{c:function(){return o}});var i=r(58655),a=r(10231);class n{constructor(t){(0,i._)(this,"httpClient",void 0),this.httpClient=t}}class o extends n{createRequestHeadersFromParams(t){var e,r,i,n,o;let s=(null==t?void 0:null===(e=t.common)||void 0===e?void 0:e.oauth)||this.config.params.common.oauth,c=(null==t?void 0:null===(r=t.common)||void 0===r?void 0:r.client)||this.config.params.common.client,l=(null==t?void 0:null===(i=t.common)||void 0===i?void 0:i.language)||this.config.params.common.language,h=(null==t?void 0:null===(n=t.common)||void 0===n?void 0:n.device)||this.config.params.common.device,u=(null==t?void 0:t.customRequestId)||(0,a.Z)(),d=null===(o=null==t?void 0:t.withoutInvocationInfo)||void 0===o||o,g={authorization:void 0!==s?"OAuth ".concat(s):void 0,"x-yandex-music-client":c,"accept-language":l,"X-Request-Id":u,"X-Yandex-Music-Device":h};return d&&(g["X-Yandex-Music-Without-Invocation-Info"]="1"),g}createTvmHeadersFromParams(t){let{params:e,target:r}=t,i=(null==e?void 0:e.tvmTickets)||this.config.params.tvmTickets;if(i&&r){let t=i[r];if(t)return{"X-Ya-Service-Ticket":t.ticket}}return{}}createYandexICookieHeaderFromConfig(){return{"x-yandex-icookie":this.config.params.common.icookie}}createUserTicketHeaderFromParams(){let t=this.config.params.userTicket;return t?{"X-Ya-User-Ticket":t}:{}}getRetryPolicyConfig(t){return{config:this.retryPolicyConfig,isNotIdempotent:t}}constructor(t,e){super(t),(0,i._)(this,"httpClient",void 0),(0,i._)(this,"config",void 0),(0,i._)(this,"retryPolicyConfig",void 0),this.httpClient=t,this.config=e,this.retryPolicyConfig=e.retryPolicyConfig}}},88328:function(t,e,r){r.d(e,{R:function(){return o}});var i=r(58655),a=r(90632),n=r(21744);class o extends a.c{async status(t,e){var r;let i=this.config.gateway.prefixUrl,a=this.config.gateway.headers,n=await this.httpClient.get("account/status",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...a},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.status,signal:null==e?void 0:e.signal});return await n.json()}async experiments(t,e){var r;let i=this.config.gateway.prefixUrl,a=this.config.gateway.headers;return(await this.httpClient.get("account/experiments",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...a},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.experiments,signal:null==e?void 0:e.signal})).json()}async experimentsDetails(t,e){var r;let i=this.config.gateway.prefixUrl,a=this.config.gateway.headers;return(await this.httpClient.get("account/experiments/details",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(),...this.createTvmHeadersFromParams({target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...a},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.experimentsDetails,signal:null==e?void 0:e.signal})).json()}async settings(t,e){var r;let i=this.config.gateway.prefixUrl,a=this.config.gateway.headers;return(await this.httpClient.post("account/settings",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...a},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.settings,searchParams:(0,n.f)({childModEnabled:null==t?void 0:t.childModEnabled}),signal:null==e?void 0:e.signal})).json()}async about(t,e){var r;let i=this.config.gateway.prefixUrl,a=this.config.gateway.headers;return(await this.httpClient.get("account/about",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...a},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.about,signal:null==e?void 0:e.signal})).json()}constructor(t,e){super(t,e),(0,i._)(this,"httpClient",void 0),(0,i._)(this,"config",void 0),this.httpClient=t,this.config=e}}},51346:function(t,e,r){r.d(e,{d:function(){return o}});var i=r(58655),a=r(21744),n=r(90632);class o extends n.c{async getFileInfo(t,e){var r;let i=this.config.gateway.prefixUrl,n=this.config.gateway.headers;return(await this.httpClient.get("get-file-info",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...n},retry:this.getRetryPolicyConfig(),searchParams:(0,a.f)({ts:t.tsInSeconds,trackId:t.trackId,quality:t.quality,codecs:t.codecs.join(","),transports:t.transports.join(","),sign:t.sign}),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.getFileInfo,signal:null==e?void 0:e.signal})).json()}async getFileInfoBatch(t,e){var r;let i=this.config.gateway.prefixUrl,n=this.config.gateway.headers;return(await this.httpClient.get("get-file-info/batch",{prefixUrl:i,headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...n},retry:this.getRetryPolicyConfig(),searchParams:(0,a.f)({ts:t.tsInSeconds,trackIds:t.trackIds,quality:t.quality,codecs:t.codecs.join(","),transports:t.transports.join(","),sign:t.sign}),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.getFileInfo,signal:null==e?void 0:e.signal})).json()}async getByteRange(t,e){var r;let i=await this.httpClient.get(t.srcUrl,{headers:{Range:"bytes=".concat(t.start,"-").concat(t.end)},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.getByteRange,signal:null==e?void 0:e.signal});return{data:await i.arrayBuffer(),contentLength:Number(i.headers["content-length"]),contentRange:i.headers["content-range"]}}constructor(t,e){super(t,e),(0,i._)(this,"httpClient",void 0),(0,i._)(this,"config",void 0),this.httpClient=t,this.config=e}}},60866:function(t,e,r){r.d(e,{F:function(){return h}});var i=r(58655),a=r(51921),n=r(90632),o=r(21744);let s=(t,e,r)=>{let{uri:i,count:a,countWeb:n,...s}=e,c=t+i,l=(0,o.f)(s);n&&l.append(r?"limit":"count",String(n));let h=l.toString();return h?"".concat(c,"?").concat(h):c};var c=r(46393);class l extends c.y{constructor(t="Landing resource error",e={}){super(t,e),(0,i._)(this,"name","LandingResourceException"),Object.setPrototypeOf(this,l.prototype)}}class h extends n.c{async getSkeleton(t,e){var r;let{gateway:i,landing:a}=this.config,n=a||i,s=n.prefixUrl,c=n.headers;return(await this.httpClient.get("landing/skeleton/".concat(t.id),{prefixUrl:s,headers:{...this.createRequestHeadersFromParams(),...this.createTvmHeadersFromParams({target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...this.createYandexICookieHeaderFromConfig(),...c},retry:this.getRetryPolicyConfig(),searchParams:(0,o.f)({showWizard:t.showWizard}),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.getSkeleton,signal:null==e?void 0:e.signal})).json()}async getBlock(t,e){var r;if(!(null==t?void 0:t.source))throw new l("Landing block source is not defined");let i=t.type===a.g.CHART_TRACKS,{gateway:n,landing:o}=this.config,c=o||n,h=c.prefixUrl,u=c.headers,d=s(h,t.source,i);return(await this.httpClient.get(d,{headers:{...this.createRequestHeadersFromParams(t),...this.createTvmHeadersFromParams({params:t,target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...this.createYandexICookieHeaderFromConfig(),...u},retry:this.getRetryPolicyConfig(),timeout:null===(r=this.config.timeouts)||void 0===r?void 0:r.getBlock,signal:null==e?void 0:e.signal})).json()}async getBlockEntities(t,e){let{blockId:r,page:i,pageSize:a}=t,n=this.config.gateway.prefixUrl,s=this.config.gateway.headers;return(await this.httpClient.get("landing/block/".concat(r,"/entities"),{prefixUrl:n,headers:{...this.createRequestHeadersFromParams(),...this.createTvmHeadersFromParams({target:this.config.params.tvmTarget}),...this.createUserTicketHeaderFromParams(),...this.createYandexICookieHeaderFromConfig(),...s},retry:this.getRetryPolicyConfig(),searchParams:(0,o.f)({page:i,pageSize:a}),signal:null==e?void 0:e.signal})).json()}constructor(t,e){super(t,e),(0,i._)(this,"httpClient",void 0),(0,i._)(this,"config",void 0),this.httpClient=t,this.config=e}}},21744:function(t,e,r){r.d(e,{f:function(){return i}});let i=t=>{let e={};return Object.getOwnPropertyNames(t).filter(e=>void 0!==t[e]&&null!==t[e]).map(r=>{e[r]=String(t[r])}),new URLSearchParams(e)}},5257:function(t,e,r){r.d(e,{I:function(){return i},U:function(){return a}});let i=()=>Math.floor(Date.now()/1e3),a=async t=>{let{secretKey:e,data:r}=t,i=new TextEncoder,a=i.encode(e);return crypto.subtle.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!0,["sign","verify"]).then(async t=>{let e=i.encode(r);return crypto.subtle.sign("HMAC",t,e).then(t=>btoa(String.fromCharCode(...new Uint8Array(t))).slice(0,-1))})}},31:function(t,e,r){var i,a;r.d(e,{n:function(){return i}}),(a=i||(i={})).LOSSLESS="lossless",a.HQ="hq",a.NQ="nq",a.LQ="lq",a.PREVIEW="preview",a.SMART_PREVIEW="smart_preview"},14178:function(t,e,r){r.d(e,{a4:function(){return tR},sp:function(){return tL},ON:function(){return tB},kf:function(){return O},aT:function(){return g},DW:function(){return tK},Jc:function(){return h},Jt:function(){return tT},tY:function(){return v},St:function(){return t_},Db:function(){return tN}});var i,a,n,o,s,c,l,h,u,d,g,v,y=r(58655),m=r(15134),p=r(49430),f=r(41172),w=r(46393);(i=l||(l={})).RESPONSE_CACHE="response_cache",i.TRACKS="tracks",i.ALBUMS="albums",i.ALBUMS_TRACKS="albums_tracks",i.ARTISTS="artists",i.ARTISTS_TRACKS="artists_tracks",i.USERS="users",i.USERS_TRACKS="users_tracks";let b={name:l.ALBUMS,version:1,restrictions:{attemptsCount:3,count:100}},E={name:l.ALBUMS_TRACKS,version:1,restrictions:{attemptsCount:3}},k={name:l.ARTISTS,version:1,restrictions:{attemptsCount:3,count:100}},C={name:l.ARTISTS_TRACKS,version:1,restrictions:{attemptsCount:3}},T={name:l.RESPONSE_CACHE,version:1,restrictions:{attemptsCount:3,count:100}};(a=h||(h={}))[a.LOW=1]="LOW",a[a.MEDIUM=2]="MEDIUM",a[a.HIGH=3]="HIGH";let I={name:l.TRACKS,version:1,restrictions:{attemptsCount:3,count:100}},R={name:l.USERS,version:1,restrictions:{attemptsCount:3,count:100}};(n=u||(u={})).TRACK="track",n.ENTITY="entity";let S={name:l.USERS_TRACKS,version:1,restrictions:{attemptsCount:3}};class _ extends w.y{constructor(t,{code:e="E_CACHE_CONTROLLER",...r}={}){super("".concat("[CacheController]"," ").concat(t),{code:e,...r}),(0,y._)(this,"name","CacheControllerException"),Object.setPrototypeOf(this,_.prototype)}}let D=[p.CN.REQUEST_TIMEOUT,p.CN.TEAPOT];class A{get shouldGetCache(){return"number"==typeof this.variables.uid&&this.variables.isOffline}getRequestId(t){return(0,m.createHash)("sha256").update(JSON.stringify(t)).digest("hex")}async get(t,e){if("number"==typeof this.variables.uid)try{let r=await this.responseCacheRepository.get(this.variables.uid,t,e);if(r)return r.response}catch(e){throw new _("Cache not found",{cause:e,data:{requestId:t,uid:this.variables.uid}})}throw new _("Cache not found",{data:{requestId:t,uid:String(this.variables.uid)}})}put(t){let{requestId:e,response:r,uid:i,priority:a}=t,n=null!=i?i:this.variables.uid;"number"==typeof n&&this.responseCacheRepository.put({uid:n,requestId:e,priority:null!=a?a:h.LOW,response:r})}async handleError(t,e,r){if(!(t instanceof p.du)||D.includes(t.statusCode))return this.get(e,r);throw t}constructor(t){(0,y._)(this,"responseCacheRepository",void 0),(0,y._)(this,"variables",void 0),this.responseCacheRepository=t.responseCacheRepository,this.variables=t.variables}}var x=r(46587);let P=t=>e=>e.id!==t||(e.stop(),!1);class F{injectTask(t){this.queue.push(t),this.startNextDownload()}removeTask(t){this.removeTaskFromQueue(t),this.removeTaskFromActiveDownloads(t)}startTask(t){this.activeTasks.push(t),t.start().finally(()=>{this.removeTaskFromActiveDownloads(t.id),this.startNextDownload()})}startNextDownload(){let t=this.activeTasks.length,e=this.variables.maxConcurrentDownloads-t;e>0&&this.queue.length>0&&this.queue.splice(0,e).forEach(this.startTask.bind(this))}removeTaskFromQueue(t){this.queue=this.queue.filter(P(t))}removeTaskFromActiveDownloads(t){this.activeTasks=this.activeTasks.filter(P(t))}constructor(t){(0,y._)(this,"variables",void 0),(0,y._)(this,"events",new x.Q),(0,y._)(this,"queue",[]),(0,y._)(this,"activeTasks",[]),this.variables=t.variables}}class O{apply(t){let{hooks:e}=t;e.afterError.tapPromise("LoggerPlugin",async t=>{let e;return(e=t instanceof w.y?t:new w.y("Error in Slam",{code:"E_SLAM",cause:t})).cause instanceof Error&&delete e.cause.stack,this.logger.error("[Slam] ".concat(e.message),{...e.data,code:e.code,cause:e.cause}),Promise.resolve()})}constructor(t){(0,y._)(this,"logger",void 0);let{logger:e}=t;this.logger=e}}let j={afterError:new(r(89747)).AsyncSeriesHook(["error"])},L=()=>"undefined"==typeof navigator?{isOffline:!1}:{isOffline:!navigator.onLine};class K{updateStatus(t){this.status=L(),t(this.status)}subscribe(t){this.updateStatus(t),window.addEventListener("online",this.updateStatus.bind(this,t)),window.addEventListener("offline",this.updateStatus.bind(this,t))}unsubscribe(t){window.removeEventListener("online",this.updateStatus.bind(this,t)),window.removeEventListener("offline",this.updateStatus.bind(this,t))}constructor(){(0,y._)(this,"status",L())}}class N{download(t){t.forEach(t=>{this.tracksController.download(t)})}stopDownload(t){t.forEach(t=>{this.tracksController.stopDownload(t)})}delete(t){t.forEach(t=>{this.tracksController.deleteTrack(t)})}constructor(t){(0,y._)(this,"tracksController",void 0),this.tracksController=t.tracksController}}class U extends w.y{constructor(t,{code:e="E_FILE_STORAGE",...r}={}){super("".concat("[FileStorage]"," ").concat(t),{code:e,...r}),(0,y._)(this,"name","FileStorageException"),Object.setPrototypeOf(this,U.prototype)}}class M{async getRootDir(){try{let t=await this.rootDir;if(!this.isAvailable||!t)throw this.generateError("FileStorage is not available");return t}catch(t){throw this.generateError("FileStorage is not available",t)}}parsePath(t){let e=t.split("/"),r=e.pop();if(!r)throw this.generateError("Invalid file path");return{name:r,dir:e.join("/")}}async getDirectoryRecursive(t,e,r){let i=e.shift();if(!i)return t;let a=await t.getDirectoryHandle(i,r);return this.getDirectoryRecursive(a,e,r)}async getDirectory(t,e){let r=t.split("/"),i=await this.getRootDir();return this.getDirectoryRecursive(i,r,e)}async getFile(t,e){let{name:r,dir:i}=this.parsePath(t);return(await this.getDirectory(i,e)).getFileHandle(r,e)}async isFileExists(t){try{return await this.getFile(t),!0}catch(t){return!1}}async writeFile(t,e){try{let r=await this.getFile(t,{create:!0}),i=await r.createWritable();await i.write(e),await i.close()}catch(e){throw this.generateError("Error when trying to write file",e,{path:t})}}async readFile(t){try{let e=await this.getFile(t);return await e.getFile()}catch(e){throw this.generateError("Error when trying to read file",e,{path:t})}}async deleteFile(t,e){try{if(!await this.isFileExists(t))return;let{name:r,dir:i}=this.parsePath(t),a=await this.getDirectory(i);return await a.removeEntry(r,e)}catch(e){throw this.generateError("Error when trying to delete file",e,{path:t})}}async createFileURL(t){try{let e=await this.getFile(t),r=await e.getFile();return URL.createObjectURL(r)}catch(e){throw this.generateError("Error when trying to create file URL",e,{path:t})}}async getEstimate(){var t,e;return(null===(e=window.navigator)||void 0===e?void 0:null===(t=e.storage)||void 0===t?void 0:t.estimate)?window.navigator.storage.estimate().catch(()=>({})):{}}generateError(t,e,r){return new U(t,{cause:e instanceof Error?e.message:String(e),data:{errorMeta:{estimate:this.estimate},...r}})}constructor(){(0,y._)(this,"rootDir",void 0),(0,y._)(this,"isAvailable",!0),(0,y._)(this,"estimate",{}),this.rootDir=window.navigator.storage.getDirectory(),this.getEstimate().then(t=>{this.estimate=t})}}class H extends w.y{constructor(t,{code:e="E_IDB_REPOSITORY",...r}={}){super("".concat("[IndexedDB]"," ").concat(t),{code:e,...r}),(0,y._)(this,"name","IdbRepositoryException"),Object.setPrototypeOf(this,H.prototype)}}class B{async clearAll(){return this.executeTransaction(async t=>t.clear(this.config.name))}async executeTransaction(t){let e=await this.idb;if(!this.isIdbAvailable||!e)throw this.generateError("IdbRepository is not available");return t(e)}async count(){return this.executeTransaction(async t=>t.count(this.config.name))}async openIdb(){return new f.r("".concat("music_slam","_").concat(this.config.name)).openDB(this.config.version,{onBlocked:(t,e,r)=>{var i,a;this.onError(),null===(a=this.handlers)||void 0===a||null===(i=a.onBlocked)||void 0===i||i.call(a,t,e,r)},onBlocking:(t,e,r)=>{var i,a;this.onError(),null===(a=this.handlers)||void 0===a||null===(i=a.onBlocking)||void 0===i||i.call(a,t,e,r)},onTerminated:()=>{var t,e;this.onError(),null===(e=this.handlers)||void 0===e||null===(t=e.onTerminated)||void 0===t||t.call(e)},onUpgrade:(t,e,r,i,a)=>{var n,o;null===(o=this.handlers)||void 0===o||null===(n=o.onUpgrade)||void 0===n||n.call(o,t,e,r,i,a)}})}onError(){this.closeConnection().finally(()=>{this.attemptsConnection<this.config.restrictions.attemptsCount?(this.attemptsConnection++,this.idb=this.openIdb()):this.isIdbAvailable=!1})}async closeConnection(){let t=await this.idb;t&&t.close()}async getEstimate(){var t,e;return(null===(e=window.navigator)||void 0===e?void 0:null===(t=e.storage)||void 0===t?void 0:t.estimate)?window.navigator.storage.estimate().catch(()=>({})):{}}generateError(t,e,r){return new H(t,{cause:e instanceof Error?e.message:String(e),data:{errorMeta:{repository:{name:String(this.config.name),version:this.config.version},estimate:this.estimate},...r}})}constructor({config:t,handlers:e}){(0,y._)(this,"idb",void 0),(0,y._)(this,"config",void 0),(0,y._)(this,"handlers",void 0),(0,y._)(this,"attemptsConnection",0),(0,y._)(this,"isIdbAvailable",!0),(0,y._)(this,"estimate",{}),this.config=t,this.handlers=e,this.idb=this.openIdb(),this.getEstimate().then(t=>{this.estimate=t})}}class q extends B{async put(t){return this.executeTransaction(async e=>{var r;let i=await e.get(b.name,String(t.id)),a=Date.now(),n=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:a;return e.put(b.name,{meta:t,updatedAt:a,createdAt:n},String(t.id))}).catch(e=>{throw this.generateError("Error when trying to put data",e,{albumId:t.id})})}async get(t){return this.executeTransaction(async e=>{var r;let i=await e.get(b.name,t);return null!==(r=null==i?void 0:i.meta)&&void 0!==r?r:null}).catch(e=>{throw this.generateError("Error when trying to get data",e,{albumId:t})})}async delete(t){return this.executeTransaction(async e=>e.delete(b.name,t)).catch(e=>{throw this.generateError("Error when trying to delete data",e,{albumId:t})})}constructor(){super({config:b,handlers:{onUpgrade:t=>{t.createObjectStore(b.name)}}})}}let W="albumId",G="trackId",V=(t,e)=>"".concat(t,":").concat(e);class Y extends B{async put(t,e){return this.executeTransaction(async r=>r.put(E.name,{trackId:t,albumId:e},V(t,e))).catch(r=>{throw this.generateError("Error when trying to put data",r,{trackId:t,albumId:e})})}async get(t,e){return this.executeTransaction(async r=>{let i=await r.get(E.name,V(t,e));return null!=i?i:null}).catch(r=>{throw this.generateError("Error when trying to get data",r,{trackId:t,albumId:e})})}async getTracksByAlbumId(t){return this.executeTransaction(async e=>(await e.getAllFromIndex(E.name,W,t)).map(t=>t.trackId)).catch(e=>{throw this.generateError("Error when trying to get data",e,{albumId:t})})}async getAlbumsByTrackId(t){return this.executeTransaction(async e=>(await e.getAllFromIndex(E.name,G,t)).map(t=>t.albumId)).catch(e=>{throw this.generateError("Error when trying to get data",e,{trackId:t})})}async delete(t,e){return this.executeTransaction(async r=>r.delete(E.name,V(t,e))).catch(r=>{throw this.generateError("Error when trying to delete data",r,{trackId:t,albumId:e})})}async getCountByAlbum(t){return this.executeTransaction(async e=>e.countFromIndex(E.name,W,t)).catch(e=>{throw this.generateError("Error when trying to get data",e,{albumId:t})})}constructor(){super({config:E,handlers:{onUpgrade:t=>{let e=t.createObjectStore(E.name);e.createIndex(W,"albumId"),e.createIndex(G,"trackId")}}})}}class z extends B{async put(t){return this.executeTransaction(async e=>{var r;let i=await e.get(k.name,String(t.id)),a=Date.now(),n=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:a;return e.put(k.name,{meta:t,updatedAt:a,createdAt:n},String(t.id))}).catch(e=>{throw this.generateError("Error when trying to put data",e,{artistId:t.id})})}async get(t){return this.executeTransaction(async e=>{var r;let i=await e.get(k.name,t);return null!==(r=null==i?void 0:i.meta)&&void 0!==r?r:null}).catch(e=>{throw this.generateError("Error when trying to get data",e,{artistId:t})})}async delete(t){return this.executeTransaction(async e=>e.delete(k.name,t)).catch(e=>{throw this.generateError("Error when trying to delete data",e,{artistId:t})})}constructor(){super({config:k,handlers:{onUpgrade:t=>{t.createObjectStore(k.name)}}})}}let Q="artistId",X="trackId",J=(t,e)=>"".concat(t,":").concat(e);class Z extends B{async put(t){let{trackId:e,artistId:r}=t;return this.executeTransaction(async i=>i.put(C.name,t,J(e,r))).catch(t=>{throw this.generateError("Error when trying to put data",t,{artistId:r,trackId:e})})}async get(t,e){return this.executeTransaction(async r=>{let i=await r.get(C.name,J(t,e));return null!=i?i:null}).catch(r=>{throw this.generateError("Error when trying to get data",r,{trackId:t,artistId:e})})}async getArtistsByTrackId(t){return this.executeTransaction(async e=>(await e.getAllFromIndex(C.name,X,t)).sort((t,e)=>t.artistIndex-e.artistIndex)).catch(e=>{throw this.generateError("Error when trying to get data",e,{trackId:t})})}async delete(t,e){return this.executeTransaction(async r=>r.delete(C.name,J(t,e))).catch(r=>{throw this.generateError("Error when trying to delete data",r,{artistId:e,trackId:t})})}async getCountByArtist(t){return this.executeTransaction(async e=>e.countFromIndex(C.name,Q,t)).catch(e=>{throw this.generateError("Error when trying to get data",e,{artistId:t})})}constructor(){super({config:C,handlers:{onUpgrade:t=>{let e=t.createObjectStore(C.name);e.createIndex(X,"trackId"),e.createIndex(Q,"artistId")}}})}}let $="priority_updatedAt",tt=(t,e)=>"".concat(t,":").concat(e);class te extends B{async put(t){let{uid:e,requestId:r}=t;return this.executeTransaction(async i=>{var a;let n=await this.get(e,r),o=Date.now(),s=null!==(a=null==n?void 0:n.createdAt)&&void 0!==a?a:o,c={...t,updatedAt:o,createdAt:s},l=await i.count(T.name);return n||l<Number(T.restrictions.count)||await this.deleteResponseByLowPriority(),i.put(T.name,c,tt(e,r))}).catch(t=>{throw this.generateError("Error when trying to put data",t,{uid:e,requestId:r})})}async get(t,e,r){let i=await this.getResponse(t,e);return i&&r&&Date.now()-i.updatedAt>r?(await this.delete(t,e),null):null!=i?i:null}async getResponse(t,e){return this.executeTransaction(async r=>{let i=tt(t,e),a=await r.get(T.name,i);return null!=a?a:null}).catch(r=>{throw this.generateError("Error when trying to get data",r,{uid:t,requestId:e})})}async delete(t,e){return this.executeTransaction(async r=>r.delete(T.name,tt(t,e))).catch(r=>{throw this.generateError("Error when trying to delete data",r,{uid:t,requestId:e})})}async deleteResponseByLowPriority(){return this.executeTransaction(async t=>{let e=t.transaction([T.name],"readwrite").objectStore(T.name).index($),r=await e.openCursor();return null==r?void 0:r.delete()}).catch(t=>{throw this.generateError("Error when trying to delete data",t)})}constructor(){super({config:T,handlers:{onUpgrade:t=>{t.createObjectStore(T.name).createIndex($,["priority","updatedAt"])}}})}}class tr extends B{async put(t){return this.executeTransaction(async e=>{var r;let i=await e.get(I.name,t.id),a=Date.now(),n=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:a;return e.put(I.name,{...i,meta:t,updatedAt:a,createdAt:n},t.id)}).catch(e=>{throw this.generateError("Error when trying to put data",e,{trackId:t.id})})}async get(t){return this.executeTransaction(async e=>{let r=await e.get(I.name,t);return null!=r?r:null}).catch(e=>{throw this.generateError("Error when trying to get data",e,{trackId:t})})}async getAllIds(){return this.executeTransaction(async t=>t.getAllKeys(I.name)).catch(t=>{throw this.generateError("Error when trying to get data",t)})}async putDecryptKey(t,e){return this.executeTransaction(async r=>{var i;let a=await r.get(I.name,t);if(!a)throw new H("Track not found");let n=Date.now(),o=null!==(i=null==a?void 0:a.createdAt)&&void 0!==i?i:n;return r.put(I.name,{meta:a.meta,decryptKey:e,updatedAt:n,createdAt:o},t)}).catch(e=>{throw this.generateError("Error when trying to put data",e,{trackId:t})})}async putTrackAvailable(t,e){return this.executeTransaction(async r=>{var i;let a=await r.get(I.name,t);if(!a)throw new H("Track not found");let n=Date.now(),o=null!==(i=null==a?void 0:a.createdAt)&&void 0!==i?i:n,{meta:s}=a;return r.put(I.name,{...a,meta:{...s,available:e},updatedAt:n,createdAt:o},t)}).catch(e=>{throw this.generateError("Error when trying to put data",e,{trackId:t})})}async getDecryptKey(t){return this.executeTransaction(async e=>{var r;let i=await e.get(I.name,t);return null!==(r=null==i?void 0:i.decryptKey)&&void 0!==r?r:null}).catch(e=>{throw this.generateError("Error when trying to get data",e,{trackId:t})})}async delete(t){return this.executeTransaction(async e=>e.delete(I.name,t)).catch(e=>{throw this.generateError("Error when trying to delete data",e,{trackId:t})})}constructor(){super({config:I,handlers:{onUpgrade:t=>{t.createObjectStore(I.name)}}})}}class ti extends B{async put(t){return this.executeTransaction(async e=>{var r;let i=await e.get(R.name,t.uid),a=Date.now(),n=null!==(r=null==i?void 0:i.createdAt)&&void 0!==r?r:a;return e.put(R.name,{...t,updatedAt:a,createdAt:n},t.uid)}).catch(e=>{throw this.generateError("Error when trying to put data",e,{uid:t.uid})})}async get(t){return this.executeTransaction(async e=>{let r=await e.get(R.name,t);return null!=r?r:null}).catch(e=>{throw this.generateError("Error when trying to get data",e,{uid:t})})}async delete(t){return this.executeTransaction(async e=>e.delete(R.name,t)).catch(e=>{throw this.generateError("Error when trying to delete data",e,{uid:t})})}constructor(){super({config:R,handlers:{onUpgrade:t=>{t.createObjectStore(R.name)}}})}}var ta=r(3228);let tn="trackId",to=(t,e)=>"".concat(t,":").concat(e);class ts extends B{async put(t){let{uid:e,trackId:r}=t;return this.executeTransaction(async i=>{var a;let n=to(e,r),o=await i.get(S.name,n),s=Date.now(),c=null!==(a=null==o?void 0:o.createdAt)&&void 0!==a?a:s;return i.put(S.name,{...t,updatedAt:s,createdAt:c},n)}).catch(t=>{throw this.generateError("Error when trying to put data",t,{uid:e,trackId:r})})}async get(t,e){return this.executeTransaction(async r=>{let i=await r.get(S.name,to(t,e));return null!=i?i:null}).catch(r=>{throw this.generateError("Error when trying to get data",r,{uid:t,trackId:e})})}async getTracksByUid(t){return this.executeTransaction(async e=>(await e.getAllFromIndex(S.name,"uid",t)).sort((t,e)=>e.createdAt-t.createdAt).map(t=>{let{trackId:e,albumId:r}=t;return String((0,ta.i)(e,r))})).catch(e=>{throw this.generateError("Error when trying to get data",e,{uid:t})})}async delete(t,e){return this.executeTransaction(async r=>r.delete(S.name,to(t,e))).catch(r=>{throw this.generateError("Error when trying to delete data",r,{uid:t,trackId:e})})}async getCountByTrackId(t){return this.executeTransaction(async e=>e.countFromIndex(S.name,tn,t)).catch(e=>{throw this.generateError("Error when trying to get data",e,{trackId:t})})}async getCountByUid(t){return this.executeTransaction(async e=>e.countFromIndex(S.name,"uid",t)).catch(e=>{throw this.generateError("Error when trying to get data",e,{uid:t})})}constructor(){super({config:S,handlers:{onUpgrade:t=>{let e=t.createObjectStore(S.name);e.createIndex("uid","uid"),e.createIndex(tn,"trackId")}}})}}let tc=t=>{let{useFileStorage:e,useResponseCacheStorage:r,useEntitiesStorage:i}=t,a={};return e&&(a.fileStorage=new M),r&&(a.responseCacheRepository=new te),i&&(a.albumsRepository=new q,a.albumsTracksRepository=new Y,a.artistsRepository=new z,a.artistsTracksRepository=new Z,a.tracksRepository=new tr,a.usersRepository=new ti,a.usersTracksRepository=new ts),a};var tl=r(73712),th=r(4520),tu=r(5257),td=r(81979);class tg extends w.y{constructor(t,{code:e="E_DOWNLOADER",...r}={}){super("".concat("[Downloader]"," ").concat(t),{code:e,...r}),(0,y._)(this,"name","DownloaderException"),Object.setPrototypeOf(this,tg.prototype)}}(o=d||(d={})).TRACK_META_RECEIVED="track_meta_received",o.TRACK_DECRYPT_KEY_RECEIVED="track_decrypt_key_received",o.CHUNK_MEDIA_FILE_RECEIVED="chunk_media_file_received",o.MEDIA_FILE_RECEIVED="media_file_received",o.TRACK_IMAGE_RECEIVED="track_image_received",o.TRACK_DOWNLOAD_FINISHED="track_download_finished",o.TRACK_DOWNLOAD_STOPPED="track_download_stopped",o.TRACK_DOWNLOAD_FAILED="track_download_failed";class tv{async getFileInfo(t,e){let r=(0,tu.I)(),i=this.variables.codecs.join(""),a="".concat(r).concat(t).concat(e).concat(i).concat(this.transport),n=await (0,tu.U)({secretKey:this.secretKey,data:a});return this.getFileInfoResource.getFileInfo({tsInSeconds:r,trackId:t,quality:e,codecs:this.variables.codecs,transports:[this.transport],sign:n})}async getTrackImage(t){try{let e=(0,th.zp)(t,this.variables.coverSize,!1),r=await fetch(e,{cache:"no-store"}),i=await r.blob();this.events.emit(d.TRACK_IMAGE_RECEIVED,this.id,i)}catch(e){this.hooks.afterError.promise(new tg("Error when downloading track image",{cause:String(e),data:{src:t}}))}}async start(){try{let[t]=await this.tracksResource.getTracksMeta({trackIds:[this.id]});if(!t||!t.available){this.handleDownloadError("Track is not defined or is not available");return}let e=String(t.id);this.events.emit(d.TRACK_META_RECEIVED,t),t.coverUri&&this.getTrackImage(t.coverUri);let{downloadInfo:r}=await this.getFileInfo(e,this.variables.quality);if("error"in r||r.transport!==td.J.ENCRAW){this.handleDownloadError("Erorr in download info or transport is not encraw");return}this.events.emit(d.TRACK_DECRYPT_KEY_RECEIVED,e,r.key);let i=null,a=0,n=[],o=r.urls[0];if(!o){this.handleDownloadError("Src is not defined");return}let s=async()=>{if(this.isStopped)return;let t=0;null===i||a+this.variables.chunkSize<i?t=a+this.variables.chunkSize-1:a+this.variables.chunkSize>=i&&(t=i);let{contentLength:e,data:r,contentRange:c}=await this.getFileInfoResource.getByteRange({srcUrl:o,start:a,end:t});a+=e,i=Number(c.split("/")[1]),n.push(r),this.events.emit(d.CHUNK_MEDIA_FILE_RECEIVED,this.id,Math.floor(a/i*100)),null!==i&&a<i&&await s()};await s(),a===i?(this.events.emit(d.MEDIA_FILE_RECEIVED,this.id,new Blob(n)),this.events.emit(d.TRACK_DOWNLOAD_FINISHED,this.id)):this.events.emit(d.TRACK_DOWNLOAD_STOPPED,this.id)}catch(t){this.handleDownloadError(String(t))}}stop(){this.isStopped=!0}handleDownloadError(t){this.hooks.afterError.promise(new tg("Error when downloading track",{cause:t,data:{id:this.id}})),this.events.emit(d.TRACK_DOWNLOAD_FAILED,this.id)}constructor(t,e){(0,y._)(this,"id",void 0),(0,y._)(this,"isStopped",!1),(0,y._)(this,"tracksResource",void 0),(0,y._)(this,"getFileInfoResource",void 0),(0,y._)(this,"secretKey",void 0),(0,y._)(this,"transport",void 0),(0,y._)(this,"variables",void 0),(0,y._)(this,"hooks",void 0),(0,y._)(this,"events",new x.Q),this.id=t,this.tracksResource=e.tracksResource,this.getFileInfoResource=e.getFileInfoResource,this.secretKey=e.secretKey,this.transport=e.transport,this.variables=e.variables,this.events=e.events,this.hooks=e.hooks}}(s=g||(g={})).IDLE="IDLE",s.DOWNLOADING="DOWNLOADING",s.DOWNLOADED="DOWNLOADED",s.DOWNLOAD_FAILED="DOWNLOAD_FAILED",s.REMOVING="REMOVING";class ty extends w.y{constructor(t,{code:e="E_TRACKS_CONTROLLER",...r}={}){super("".concat("[TracksController]"," ").concat(t),{code:e,...r}),(0,y._)(this,"name","TracksControllerException"),Object.setPrototypeOf(this,ty.prototype)}}let tm=t=>"images/tracks/".concat(t),tp=t=>"tracks/".concat(t);var tf=r(83840);let tw=t=>"object"==typeof t&&"id"in t;class tb{async putTrackArtists(t){let e=0;if(!t.artists)return Promise.resolve();let r=[];return t.artists.forEach(i=>{let{decomposed:a,...n}=i;r.push({artistMeta:n,artistTrack:{artistId:String(i.id),trackId:String(t.id),artistIndex:e}}),e++;let o="";a&&a.length>0&&a.forEach(i=>{if("string"==typeof i){o=i;return}r.push({artistMeta:i,artistTrack:{artistId:String(i.id),trackId:String(t.id),artistIndex:e,decomposed:!0,prefix:o}}),e++,o=""})}),Promise.all(r.map(async t=>{var e,r;let{artistMeta:i,artistTrack:a}=t;return Promise.all([null===(e=this.repositoryContainer.artistsRepository)||void 0===e?void 0:e.put(i),null===(r=this.repositoryContainer.artistsTracksRepository)||void 0===r?void 0:r.put(a)])}))}async putTrackAlbums(t){return t.albums?Promise.all(t.albums.map(async e=>{var r,i;let{artists:a,...n}=e;return Promise.all([null===(r=this.repositoryContainer.albumsRepository)||void 0===r?void 0:r.put(n),null===(i=this.repositoryContainer.albumsTracksRepository)||void 0===i?void 0:i.put(String(t.id),String(n.id))])})):Promise.resolve()}async getTrackArtists(t){var e;let r;let i=await (null===(e=this.repositoryContainer.artistsTracksRepository)||void 0===e?void 0:e.getArtistsByTrackId(t));if(!(null==i?void 0:i.length))return[];let a=await Promise.all(i.map(async t=>{var e;let{artistId:r}=t;return null===(e=this.repositoryContainer.artistsRepository)||void 0===e?void 0:e.get(r)})),n=[];return i.forEach((t,e)=>{let{decomposed:i,prefix:o}=t,s=a[e];if(s){if(!i&&tw(s)){r=s,n.push(s);return}r&&(void 0===r.decomposed&&(r.decomposed=[]),o&&r.decomposed.push(o),r.decomposed.push(s))}}),n}async getTrackAlbums(t,e){var r,i;let a=[];if(e){let t=await (null===(r=this.repositoryContainer.albumsRepository)||void 0===r?void 0:r.get(e));t&&a.push({...t,artists:[]})}else{let e=await (null===(i=this.repositoryContainer.albumsTracksRepository)||void 0===i?void 0:i.getAlbumsByTrackId(t));if(!(null==e?void 0:e.length))return a;(await Promise.all(e.map(async t=>this.repositoryContainer.albumsRepository?this.repositoryContainer.albumsRepository.get(t):null))).forEach(t=>{t&&a.push({...t,artists:[]})})}return a}async deleteTrackArtists(t){var e;let r=await (null===(e=this.repositoryContainer.artistsTracksRepository)||void 0===e?void 0:e.getArtistsByTrackId(t));return(null==r?void 0:r.length)?Promise.all(r.map(async e=>{var r,i,a;let{artistId:n}=e;return(await (null===(r=this.repositoryContainer.artistsTracksRepository)||void 0===r?void 0:r.delete(t,n)),0===await (null===(i=this.repositoryContainer.artistsTracksRepository)||void 0===i?void 0:i.getCountByArtist(n)))?null===(a=this.repositoryContainer.artistsRepository)||void 0===a?void 0:a.delete(n):Promise.resolve()})):Promise.resolve()}async deleteTrackAlbums(t){var e;let r=await (null===(e=this.repositoryContainer.albumsTracksRepository)||void 0===e?void 0:e.getAlbumsByTrackId(t));return(null==r?void 0:r.length)?Promise.all(r.map(async e=>{var r,i,a;return(await (null===(r=this.repositoryContainer.albumsTracksRepository)||void 0===r?void 0:r.delete(t,e)),0===await (null===(i=this.repositoryContainer.albumsTracksRepository)||void 0===i?void 0:i.getCountByAlbum(e)))?null===(a=this.repositoryContainer.albumsRepository)||void 0===a?void 0:a.delete(e):Promise.resolve()})):Promise.resolve()}async saveTrack(t){var e;let r=(0,tf.Z)(t);return delete r.albums,delete r.artists,Promise.all([null===(e=this.repositoryContainer.tracksRepository)||void 0===e?void 0:e.put(r),this.putTrackAlbums(t),this.putTrackArtists(t)])}async getTrack(t){var e,r;let[i,a]=(0,ta.f)(t);if(!i)return null;let n=await (null===(e=this.repositoryContainer.tracksRepository)||void 0===e?void 0:e.get(i));if(!n)return null;let o=n.meta;return o.coverUri&&(o.coverUri=await (null===(r=this.repositoryContainer.fileStorage)||void 0===r?void 0:r.createFileURL(tm(t)))),o.albums=await this.getTrackAlbums(String(o.id),a),o.artists=await this.getTrackArtists(String(o.id)),o}async deleteTrack(t,e){var r,i,a;return Promise.all([null===(r=this.repositoryContainer.fileStorage)||void 0===r?void 0:r.deleteFile(tp(t)),null===(i=this.repositoryContainer.fileStorage)||void 0===i?void 0:i.deleteFile(tm(String((0,ta.i)(t,e)))),null===(a=this.repositoryContainer.tracksRepository)||void 0===a?void 0:a.delete(t),this.deleteTrackAlbums(t),this.deleteTrackArtists(t)])}constructor({repositoryContainer:t}){(0,y._)(this,"repositoryContainer",void 0),this.repositoryContainer=t}}(c=v||(v={})).TRACK_CHANGED="track_changed",c.STATE_CHANGED="state_changed";let tE=[g.IDLE,g.DOWNLOAD_FAILED],tk=[g.IDLE,g.DOWNLOADING];class tC{async initTracksState(){try{var t;let e=await (null===(t=this.repositoryContainer.usersTracksRepository)||void 0===t?void 0:t.getTracksByUid(this.userConfig.uid));(null==e?void 0:e.length)&&(this.state=e.reduce((t,e)=>{let[r]=(0,ta.f)(e);return r&&(t[r]={loadingState:g.DOWNLOADED}),t},{})),this.events.emit(v.STATE_CHANGED,this.state)}catch(t){this.hooks.afterError.promise(new ty("Failed to init tracks state",{cause:t}))}}async clearAll(){try{var t;let e=await (null===(t=this.repositoryContainer.usersTracksRepository)||void 0===t?void 0:t.getTracksByUid(this.userConfig.uid));null==e||e.forEach(t=>{this.deleteTrack(t)}),this.state={},this.events.emit(v.STATE_CHANGED,this.state)}catch(t){this.hooks.afterError.promise(new ty("Failed to clear all tracks",{cause:t}))}}async validateTracks(){try{var t;let e=await (null===(t=this.repositoryContainer.tracksRepository)||void 0===t?void 0:t.getAllIds());e&&e.forEach(async t=>{var e;let r=String(t),i=await (null===(e=this.repositoryContainer.usersTracksRepository)||void 0===e?void 0:e.getCountByTrackId(r));0===i&&this.deleteTrack(r)})}catch(t){this.hooks.afterError.promise(new ty("Failed to validate tracks",{cause:t}))}}download(t){var e;let[r]=(0,ta.f)(t);if(!r)return;let i=null===(e=this.state[r])||void 0===e?void 0:e.loadingState;(!this.state[r]||i&&tE.includes(i))&&this.downloader.injectTask(new tv(String(t),this.trackDownloadTaskParams))}stopDownload(t){var e;let[r]=(0,ta.f)(t);if(!r)return;let i=null===(e=this.state[r])||void 0===e?void 0:e.loadingState;(!this.state[r]||i&&tk.includes(i))&&(this.changeState(r,{loadingState:g.IDLE}),this.downloader.removeTask(String(t)))}async getTracks(){var t;let e=await (null===(t=this.repositoryContainer.usersTracksRepository)||void 0===t?void 0:t.getTracksByUid(this.userConfig.uid));return e?(await Promise.all(null==e?void 0:e.map(async t=>this.getTrack(t)))).filter(t=>null!==t):[]}async getTracksCount(){var t;let e=await (null===(t=this.repositoryContainer.usersTracksRepository)||void 0===t?void 0:t.getCountByUid(this.userConfig.uid));return null!=e?e:0}async getTrack(t){try{return await this.trackManager.getTrack(t)}catch(e){return this.hooks.afterError.promise(new ty("Failed to get track",{cause:e,data:{id:t}})),null}}async deleteTrack(t){try{var e,r;let[i,a]=(0,ta.f)(t);if(!i)return;await (null===(e=this.repositoryContainer.usersTracksRepository)||void 0===e?void 0:e.delete(this.userConfig.uid,i)),this.changeState(i,{loadingState:g.IDLE});let n=await (null===(r=this.repositoryContainer.usersTracksRepository)||void 0===r?void 0:r.getCountByTrackId(i));if(0!==n)return;await this.trackManager.deleteTrack(i,a)}catch(e){this.hooks.afterError.promise(new ty("Failed to delete track",{cause:e,data:{id:t}}))}}async refreshTracksAvailability(){try{var t;let e=await (null===(t=this.repositoryContainer.usersTracksRepository)||void 0===t?void 0:t.getTracksByUid(this.userConfig.uid));if(!e)return;let r=async t=>{(await this.availabilityResource.getAvailabilityTracks({trackIds:t})).availabilities.forEach(t=>{let{trackId:e,available:r}=t,[i]=(0,ta.f)(e);if(i){var a;null===(a=this.repositoryContainer.tracksRepository)||void 0===a||a.putTrackAvailable(i,r)}})},i=(0,tl.Z)(e,this.variables.requestTrackChunkSize);Promise.all(i.map(r))}catch(t){this.hooks.afterError.promise(new ty("Failed to refresh tracks availability",{cause:t}))}}async refreshTracksMeta(){try{var t;let e=await (null===(t=this.repositoryContainer.usersTracksRepository)||void 0===t?void 0:t.getTracksByUid(this.userConfig.uid));if(!e)return;let r=async t=>{(await this.tracksResource.getTracksMeta({trackIds:t})).forEach(this.updateTrackMeta.bind(this))},i=(0,tl.Z)(e,this.variables.requestTrackChunkSize);Promise.all(i.map(r))}catch(t){this.hooks.afterError.promise(new ty("Failed to refresh tracks meta",{cause:t}))}}async updateTrackMeta(t){try{var e,r,i;let a=await (null===(e=this.repositoryContainer.usersTracksRepository)||void 0===e?void 0:e.get(this.userConfig.uid,String(t.id)));if(!a)return;let n=null===(i=t.albums)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.id;if(void 0===a.albumId&&void 0===n||a.albumId===String(n)){await this.trackManager.deleteTrackArtists(String(t.id)),this.trackManager.saveTrack(t);return}await this.deleteTrack(String((0,ta.i)(a.trackId,a.albumId))),this.download(String((0,ta.i)(t.id,n)))}catch(e){this.hooks.afterError.promise(new ty("Failed to update track meta",{cause:e,data:{id:t.id}}))}}onTrackMetaReceived(t){this.changeState(String(t.id),{loadingState:g.DOWNLOADING}),this.trackManager.saveTrack(t)}onTrackDownloadFinished(t){var e;let[r,i]=(0,ta.f)(t);r&&(null===(e=this.repositoryContainer.usersTracksRepository)||void 0===e||e.put({uid:this.userConfig.uid,downloadSource:u.TRACK,trackId:r,albumId:i}),this.changeState(r,{loadingState:g.DOWNLOADED}))}onTrackDownloadStopped(t){let[e]=(0,ta.f)(t);e&&(this.deleteTrack(t),this.changeState(e,{loadingState:g.IDLE}))}onTrackDecryptKeyReceived(t,e){var r;null===(r=this.repositoryContainer.tracksRepository)||void 0===r||r.putDecryptKey(t,e)}onTrackDownloadFailed(t){let[e]=(0,ta.f)(t);e&&(this.deleteTrack(t),this.changeState(e,{loadingState:g.DOWNLOAD_FAILED}))}onTrackImageReceived(t,e){var r;let i=tm(t);null===(r=this.repositoryContainer.fileStorage)||void 0===r||r.writeFile(i,e).catch(e=>{this.hooks.afterError.promise(new ty("Failed to write track image",{cause:e,data:{path:i}})),this.stopDownload(t),this.onTrackDownloadFailed(t)})}onChunkMediaFileReceived(t,e){var r;let[i]=(0,ta.f)(t);i&&(null===(r=this.state[i])||void 0===r?void 0:r.loadingState)!==g.IDLE&&this.changeState(i,{loadingState:g.DOWNLOADING,progress:e})}onMediaFileReceived(t,e){var r,i;let[a]=(0,ta.f)(t);if(!a||(null===(r=this.state[a])||void 0===r?void 0:r.loadingState)===g.IDLE)return;let n=tp(a);null===(i=this.repositoryContainer.fileStorage)||void 0===i||i.writeFile(n,e).catch(e=>{this.hooks.afterError.promise(new ty("Failed to write media file",{cause:e,data:{path:n}})),this.stopDownload(t),this.onTrackDownloadFailed(t)})}changeState(t,e){this.state[t]=e,this.events.emit(v.TRACK_CHANGED,{trackId:t,state:e})}constructor(t){(0,y._)(this,"userConfig",void 0),(0,y._)(this,"downloader",void 0),(0,y._)(this,"repositoryContainer",void 0),(0,y._)(this,"trackManager",void 0),(0,y._)(this,"trackDownloadTaskParams",void 0),(0,y._)(this,"availabilityResource",void 0),(0,y._)(this,"tracksResource",void 0),(0,y._)(this,"variables",void 0),(0,y._)(this,"hooks",void 0),(0,y._)(this,"state",{}),(0,y._)(this,"events",new x.Q),this.userConfig=t.userConfig,this.downloader=t.downloader,this.repositoryContainer=t.repositoryContainer,this.trackDownloadTaskParams=t.trackDownloadTaskParams,this.availabilityResource=t.availabilityResource,this.tracksResource=t.tracksResource,this.variables=t.variables,this.hooks=t.hooks,this.trackManager=new tb({repositoryContainer:this.repositoryContainer}),this.validateTracks(),this.downloader.events.on(d.TRACK_META_RECEIVED,this.onTrackMetaReceived.bind(this)),this.downloader.events.on(d.TRACK_DECRYPT_KEY_RECEIVED,this.onTrackDecryptKeyReceived.bind(this)),this.downloader.events.on(d.CHUNK_MEDIA_FILE_RECEIVED,this.onChunkMediaFileReceived.bind(this)),this.downloader.events.on(d.TRACK_IMAGE_RECEIVED,this.onTrackImageReceived.bind(this)),this.downloader.events.on(d.TRACK_DOWNLOAD_FINISHED,this.onTrackDownloadFinished.bind(this)),this.downloader.events.on(d.TRACK_DOWNLOAD_STOPPED,this.onTrackDownloadStopped.bind(this)),this.downloader.events.on(d.TRACK_DOWNLOAD_FAILED,this.onTrackDownloadFailed.bind(this)),this.downloader.events.on(d.MEDIA_FILE_RECEIVED,this.onMediaFileReceived.bind(this))}}class tT{init(t){var e;let{userConfig:r}=t;this.userConfig=r,null===(e=this.repositoryContainer.usersRepository)||void 0===e||e.put({uid:r.uid})}createDownloader(t){this.downloader||(this.downloader=new F(t))}createTracksController(t){this.tracksController||(this.tracksController=new tC(t))}createPlaylistsController(t){this.playlistsController||(this.playlistsController=new N(t))}createCacheController(t){this.cacheController||(this.cacheController=new A(t))}async clearAll(){var t;return Promise.all([null===(t=this.tracksController)||void 0===t?void 0:t.clearAll()])}constructor({config:t,plugins:e}){(0,y._)(this,"hooks",j),(0,y._)(this,"network",new K),(0,y._)(this,"repositoryContainer",void 0),(0,y._)(this,"config",void 0),(0,y._)(this,"userConfig",null),(0,y._)(this,"cacheController",null),(0,y._)(this,"downloader",null),(0,y._)(this,"tracksController",null),(0,y._)(this,"playlistsController",null),this.config=t,this.repositoryContainer=tc(this.config),null==e||e.forEach(t=>t.apply({hooks:this.hooks}))}}var tI=r(88328);class tR extends tI.R{async about(t,e){let r=this.cacheController.getRequestId({resourceName:tI.R.constructor.name,methodName:this.about.name,args:[t]});if(this.cacheController.shouldGetCache)return this.cacheController.get(r,6048e5);try{let i=await super.about(t,e);return this.cacheController.put({requestId:r,response:i,uid:i.uid,priority:h.MEDIUM}),i}catch(t){return this.cacheController.handleError(t,r,6048e5)}}async settings(t,e){let r=this.cacheController.getRequestId({resourceName:tI.R.constructor.name,methodName:this.settings.name,args:[t]});if(this.cacheController.shouldGetCache)return this.cacheController.get(r,6048e5);try{let i=await super.settings(t,e);return this.cacheController.put({requestId:r,response:i,priority:h.MEDIUM}),i}catch(t){return this.cacheController.handleError(t,r,6048e5)}}async experiments(t,e){let r=this.cacheController.getRequestId({resourceName:tI.R.constructor.name,methodName:this.experiments.name,args:[t]});if(this.cacheController.shouldGetCache)return this.cacheController.get(r,6048e5);try{let i=await super.experiments(t,e);return this.cacheController.put({requestId:r,response:i,priority:h.MEDIUM}),i}catch(t){return this.cacheController.handleError(t,r,6048e5)}}async experimentsDetails(t,e){let r=this.cacheController.getRequestId({resourceName:tI.R.constructor.name,methodName:this.experimentsDetails.name,args:[t]});if(this.cacheController.shouldGetCache)return this.cacheController.get(r,6048e5);try{let i=await super.experimentsDetails(t,e);return this.cacheController.put({requestId:r,response:i,priority:h.MEDIUM}),i}catch(t){return this.cacheController.handleError(t,r,6048e5)}}constructor(t,e,r){super(t,e),(0,y._)(this,"httpClient",void 0),(0,y._)(this,"config",void 0),(0,y._)(this,"cacheController",void 0),this.httpClient=t,this.config=e,this.cacheController=r.cacheController}}let tS=(t,e)=>{var r,i,a,n;let o=null===(r=t.overrides)||void 0===r?void 0:r[e];return{enabled:null!==(i=null==o?void 0:o.enabled)&&void 0!==i?i:t.enabled,ttl:null!==(a=null==o?void 0:o.ttl)&&void 0!==a?a:t.ttl,priority:null!==(n=null==o?void 0:o.priority)&&void 0!==n?n:t.priority}},t_=t=>{let{resource:e,cacheController:r,config:i}=t;return new Proxy(e,{get(t,e){let a=t[e],{enabled:n,ttl:o,priority:s}=tS(i,e);return"function"==typeof a&&n?async function(){for(var n=arguments.length,c=Array(n),l=0;l<n;l++)c[l]=arguments[l];let{resourceName:h}=i.common,u=r.getRequestId({resourceName:h,prop:e,args:c});if(r.shouldGetCache)return r.get(u,o);try{let e=await a.apply(t,c);return r.put({requestId:u,response:e,priority:s}),e}catch(t){return r.handleError(t,u,o)}}:a}})};var tD=r(51346);class tA extends w.y{constructor(t,{code:e="E_RESOURCE_PROXY",...r}={}){super("".concat("[ResourceProxy]"," ").concat(t),{code:e,...r}),(0,y._)(this,"name","ResourceProxyException"),Object.setPrototypeOf(this,tA.prototype)}}var tx=r(31);let tP=[tx.n.PREVIEW,tx.n.SMART_PREVIEW],tF=t=>new Uint8Array(t.match(/.{1,2}/g).map(t=>parseInt(t,16))),tO=t=>{let e=t,r=new Uint8Array(16);for(let t=0;t<16;++t)r[r.length-1-t]=255&e,e>>=8;return r},tj=async t=>{let{key:e,data:r,loadedBytes:i}=t,a=await crypto.subtle.importKey("raw",tF(e),{name:"AES-CTR"},!1,["encrypt","decrypt"]),n=new Uint8Array(16);return i&&(n=tO(i/16)),crypto.subtle.decrypt({name:"AES-CTR",counter:n,length:128},a,r)};class tL extends tD.d{async isTrackDownloaded(t,e){if(!this.variables.uid||tP.includes(e))return!1;try{return!!await this.usersTracksRepository.get(this.variables.uid,t)}catch(e){return this.hooks.afterError.promise(new tA("Can not determine if track was downloaded",{cause:e,data:{trackId:t}})),!1}}async getLocalFileDownloadInfo(t){let e=await this.tracksRepository.getDecryptKey(String(t));if(!e)throw new tA("Decrypt key not found");let r=await this.fileStorage.readFile(tp(String(t))),i=r.slice(0,r.size),a=await i.arrayBuffer(),n=await tj({data:a,key:e});return{trackId:t,urls:[URL.createObjectURL(new Blob([n]))]}}async getFileInfo(t,e){if(!await this.isTrackDownloaded(String(t.trackId),t.quality))return super.getFileInfo(t,e);try{return{downloadInfo:await this.getLocalFileDownloadInfo(String(t.trackId))}}catch(r){return this.hooks.afterError.promise(new tA("Can not get a local file",{cause:r,data:{trackId:t.trackId}})),super.getFileInfo(t,e)}}async getSign(t,e,r,i){let a=(0,tu.I)(),n=t.join(","),o=e.join(""),s="".concat(a).concat(n).concat(r).concat(o).concat(i);return(0,tu.U)({secretKey:this.variables.secretKey,data:s})}async getFileInfoBatch(t,e){let r=t.trackIds.split(","),i=await Promise.all(r.map(async e=>this.isTrackDownloaded.bind(this)(e,t.quality))),a={},n=[],o=[];r.forEach((t,e)=>{a[t]=e,i[e]?o.push(t):n.push(t)});let s=await Promise.allSettled(o.map(this.getLocalFileDownloadInfo.bind(this))),c=[];s.forEach((t,e)=>{switch(t.status){case"fulfilled":{let e=a[t.value.trackId];void 0!==e&&(c[e]=t.value);break}case"rejected":{let t=o[e];t&&(this.hooks.afterError.promise(new tA("Can not get a local file",{data:{trackId:t}})),n.push(t))}}});let l=null;if(n.length>0){let r=t.transports[0]||td.J.RAW,i=await this.getSign(n,t.codecs,t.quality,r);try{l=(await super.getFileInfoBatch({...t,sign:i,trackIds:n.join(",")},e)).downloadInfos}catch(t){this.hooks.afterError.promise(new tA("Can not get file info batch",{cause:String(t),data:{trackIds:n.join(",")}}))}}return null==l||l.forEach(t=>{let e=a[t.trackId];void 0!==e&&(c[e]=t)}),{downloadInfos:c}}constructor(t,e,r){super(t,e),(0,y._)(this,"httpClient",void 0),(0,y._)(this,"config",void 0),(0,y._)(this,"fileStorage",void 0),(0,y._)(this,"tracksRepository",void 0),(0,y._)(this,"usersTracksRepository",void 0),(0,y._)(this,"hooks",void 0),(0,y._)(this,"variables",void 0),this.httpClient=t,this.config=e;let{fileStorage:i,tracksRepository:a,usersTracksRepository:n,hooks:o,variables:s}=r;this.fileStorage=i,this.tracksRepository=a,this.usersTracksRepository=n,this.hooks=o,this.variables=s}}let tK=p.CN.TEAPOT,tN=(t,e)=>new Proxy(t,{get(t,r){let i=t[r],{isOffline:a}=e;return"function"==typeof i&&a?function(){throw new p.du("Offline mode enabled",{statusCode:tK})}:i}});var tU=r(60866),tM=r(51921),tH=r(62043);class tB extends tU.F{async getCollectionDownloadedTracks(){let t={tracks:[]};if(!this.variables.tracksController)return t;try{return{tracks:await this.variables.tracksController.getTracks()}}catch(e){return this.hooks.afterError.promise(new tA("Can not get collection downloaded tracks",{cause:e})),t}}async getBlock(t,e){return t.type===tM.g.COLLECTION_DOWNLOADED_TRACKS?this.getCollectionDownloadedTracks():super.getBlock(t,e)}async getSkeleton(t,e){if(!this.variables.cacheController)return super.getSkeleton(t,e);if(t.id===tH.j.WEB_COLLECTION){let r=this.variables.cacheController.getRequestId({resourceName:tU.F.constructor.name,methodName:this.getSkeleton.name,args:[t]});if(this.variables.cacheController.shouldGetCache)return this.variables.cacheController.get(r,6048e5);try{let i=await super.getSkeleton(t,e);return this.variables.cacheController.put({requestId:r,response:i,priority:h.MEDIUM}),i}catch(t){return this.variables.cacheController.handleError(t,r,6048e5)}}return super.getSkeleton(t,e)}constructor(t,e,r){super(t,e),(0,y._)(this,"httpClient",void 0),(0,y._)(this,"config",void 0),(0,y._)(this,"hooks",void 0),(0,y._)(this,"variables",void 0),this.httpClient=t,this.config=e,this.hooks=r.hooks,this.variables=r.variables}}}}]);